YUI.add("flickr-photosets-editMeta-updater",function(e,t){"use strict";var o=require("hermes-core/flog")(t);e.namespace("ModelUpdaters")["flickr-photosets-editMeta"]={run:function(o,s){var i={},r=this;return i.photoset_id=o.photosetId,i.title=o.title,i.description=o.description,o.includeHiddenSets&&(i.extras="hidden_sets"),e.Promise.all([s.callAPI("flickr.photosets.editMeta",i),s.getModelRegistry("set-models")]).then(function(e){r._processResponse(e,o,s)},e.FetcherErrorLogger(t))},_processResponse:function(e,t,s){var i=e[0],r=e[1];if(i.photoset&&i.photoset.title&&i.photoset.description){if(!r.exists(t.photosetId))throw new Error("[flickr-photosets-editMeta-updater] - Set model cannot be updated if it does not exist");r.setValues(t.photosetId,{title:i.photoset.title.content,description:i.photoset.description.content})}else o.warn("No updated data returned from API.")}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photosets-setPrimaryPhoto-updater",function(r,t){"use strict";r.namespace("ModelUpdaters")["flickr-photosets-setPrimaryPhoto"]={run:function(o,e){var s={};return s.photoset_id=o.albumId,s.photo_id=o.photoId,e.callAPI("flickr.photosets.setPrimaryPhoto",s).then(null,r.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("set-models",function(e,t){function o(e){o.superclass.constructor.call(this,e)}var r=require("hermes-core/flog")(t);e.Models[this.name]=o,e.extend(o,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photosets-getPhotos"].run(t,this.appContext)},create:function(t,o){return e.ModelCreators["flickr-photosets-create"].run(t,o)},createHidden:function(t,o){return e.ModelCreators["flickr-photosets-createHidden"].run(t,o)},addPhoto:function(t,o){return e.ModelCreators["flickr-photosets-addPhoto"].run(t,o)},removePhoto:function(t,o){return e.ModelCreators["flickr-photosets-removePhoto"].run(t,o)},update:function(t,o){return e.ModelUpdaters["flickr-photosets-editMeta"].run({photosetId:t,title:o.title?o.title.newVal:this.getValue(t,"title"),description:o.description?o.description.newVal:this.getValue(t,"description")},this.appContext)},setPrimaryPhoto:function(t,o){return e.ModelUpdaters["flickr-photosets-setPrimaryPhoto"].run(t,o)},delete:function(t){if("string"==typeof t){t={setID:t}}return e.ModelDeletors["flickr-photosets-delete-deletor"].run(t,this.appContext)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},getSizeToFit:function(t,o,i){r.info("Using `getSizeToFit` is deprecated. See model comments for more details.");var n=e.PhotoModelHelper.getSizeToFit(t,o,e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0},i));return n&&(n.url=n.src),n},getLargestPrimaryPhotoSize:function(t,o){return e.PhotoModelHelper.getLargestSize(t,o)},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"set"}},title:{validator:function(t,o){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,o){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photosets-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photosets-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},publicPhotosCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},totalCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultFn:function(e){return this.getValue(e,"photoCount")+this.getValue(e,"videoCount")}},viewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCountDisplay:{readOnly:!0,derivedBy:["totalCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r=this.getValue(e,"totalCount"),i="";return 0===(t-=o)&&0===o?i=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===t&&0===o?i=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&0===o?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0===t&&1===o?i=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===t&&1===o?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&1===o?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0===t&&o>1?i=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:o}):1===t&&o>1?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:o}):t>1&&o>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:o})),0===r?i=this.intlMessage({intlName:"models.ZERO_ITEMS"}):1===r?i=this.intlMessage({intlName:"models.ONE_ITEM"}):r>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_ITEMS",items:r})),i}},photoAndVideosDisplay:{readOnly:!0,derivedBy:["photoCount","videoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r="";return 0===t&&0===o?r=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===t&&0===o?r=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&0===o?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0===t&&1===o?r=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===t&&1===o?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&1===o?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0===t&&o>1?r=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:o}):1===t&&o>1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:o}):t>1&&o>1&&(r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:o})),r}},sharedEntityDisplay:{readOnly:!0,derivedBy:["videoCount","photoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r=this.getValue(e,"owner"),i="";return t&&!o?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_ONLY",username:r.getValue("displayname"),photoCount:parseInt(t,10)}):!t&&o?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_VIDEOS_ONLY",username:r.getValue("displayname"),videoCount:parseInt(o,10)}):t&&o&&(i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_VIDEOS",username:r.getValue("displayname"),photoCount:parseInt(t,10),videoCount:parseInt(o,10)})),i}},primary:{},primaryPhotoSizes:{},primaryNeedsInterstitial:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(t){var o=e.PhotoModelHelper.getSizeToFit(t,{height:75,width:75},e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0}));return o?o.src:""}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),o=this.getValue(e,"isSharedEntity"),r=this.getValue(e,"normalizedId");return t&&!0===o?"/photos/"+t.getValue("pathAlias")+"/shares/"+r:t?"/photos/"+t.getValue("pathAlias")+"/albums/"+r:void 0}},isAutoUploadSet:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isSharedEntity:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canShare:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},canDownload:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},urlSuffix:{readOnly:!0,defaultFn:function(e){return this.getValue(e,"isSharedEntity")?"shares-"+e:"album-"+e}},gpCode:{defaultFn:function(e){return null}},gpOwner:{defaultFn:function(e){return null}}}},{buildCompoundId:function(e,t,o){var r=e;return t&&(r+="-"+t),o&&(t||(r+="-dateposted"),r+="-"+o),r},splitCompoundId:function(e){var t=e.split("-");return{nsid:t[0],orderBy:t[1],viewAs:t[2]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-addPhoto-creator","flickr-photosets-removePhoto-deletor","flickr-photosets-delete-deletor","flickr-photosets-getPhotos-fetcher","flickr-photosets-getContext-fetcher","flickr-photosets-create-creator","flickr-photosets-createHidden-creator","flickr-photosets-editMeta-updater","flickr-photosets-setPrimaryPhoto-updater","photo-model-helper"],langBundles:["models","shared-entity"]});YUI.add("flickr-photos-getAllContexts-fetcher",function(e,t){"use strict";e.namespace("ModelFetchers")["flickr-photos-getAllContexts"]={run:function(o,s){var l=this;return s.flipper.isFlipped("enable-scrappy-photo-page")&&(o.scrappy=!0),e.Promise.all([s.callAPI("flickr.photos.getAllContexts",this._processParams(o),!0),s.getModelRegistry("person-models"),s.getModelRegistry("photo-contexts-models"),s.getModelRegistry("favorite-models"),s.getModelRegistry("gallery-models"),s.getModelRegistry("group-pool-models"),s.getModelRegistry("set-models"),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-groups-models"),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-galleries-models"),s.getModelRegistry("group-models")]).then(function(e){return l._processResponse(e,o)},e.FetcherErrorLogger(t))},_processParams:function(t){var o;return o={photo_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras()+","+e.APIHelper.request.getRebootGroupExtras()+","+e.APIHelper.request.getRebootAlbumsListExtras(),primary_photo_extras:"url_sq, url_t, url_s, url_m, needs_interstitial"},t.scrappy&&(o.get_all_galleries=1,o.no_faves_context=1,o.per_type_limit=6,o.get_totals=1,o.sort="date-desc"),o},_processResponse:function(t,o){var s,l,r=t[0],a=t[1],p=t[2],d={},i=[],g=t[8],n=t[9],u=t[10],m=t[11];return d.faves=t[3],d.gallery=t[4],d.pool=t[5],d.set=t[6],d.stream=t[7],e.Object.each(d,function(t,o){r[o]&&e.Array.each(r[o],function(o){e.APIHelper.response.addContextToRegistry(o,t,a,m),i.push(t.proxy(o.id))})}),p.exists(o.id)||(s=p.add({id:o.id,totalGroups:r.totals&&r.totals.groups,totalSets:r.totals&&r.totals.sets,totalGalleries:r.totals&&r.totals.galleries}),p.setValue(o.id,"contexts",i)),g.addOrUpdate({id:o.id,total:r.totals&&r.totals.groups,groups:p.getContextsOfType(o.id,"group-pool-models")}),(l=p.getContextsOfType(o.id,"set-models")).forEach(function(e){e.setValue("totalCount",parseInt(e.getValue("photoCount"),10)+parseInt(e.getValue("videoCount"),10))}),n.addOrUpdate({id:o.id,total:r.totals&&r.totals.sets,sets:l}),u.addOrUpdate({id:o.id,total:r.totals&&r.totals.galleries,galleries:p.getContextsOfType(o.id,"gallery-models")}),s}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-contexts-models","favorite-models","gallery-models","group-pool-models","photostream-models","set-models","photo-groups-models","photo-sets-models","photo-galleries-models","group-models"]});YUI.add("photo-contexts-models",function(e){function t(e){t.superclass.constructor.call(this,e),this.getMorePromises={"group-pool-models":{},"set-models":{},"gallery-models":{}},this.continuationKeys={"group-pool-models":{},"set-models":{},"gallery-models":{}}}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return this.appContext.flipper.isFlipped("enable-scrappy-photo-page")?e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext):e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)}},getMoreContextsOfType:function(t,r,o){var s,n,i,l,a,p,u,c=this,g=e.APIHelper.request.getRebootPhotoExtras();switch(r){case"group-pool-models":s="flickr.photos.getGroups",i="groups.group",g+=","+e.APIHelper.request.getRebootGroupExtras();break;case"set-models":s="flickr.photos.getSets",i="sets.set";break;case"gallery-models":s="flickr.photos.getGalleries",i="galleries.gallery"}return s?this.exists(t)?"-1"===(l=this.continuationKeys[r][t]||"0")?e.Promise.resolve({type:r,newContexts:[],loadedAll:!0}):(n={photo_id:t,extras:g,primary_photo_extras:"url_sq, url_t, url_s, url_m",continuation:l,per_page:o},p=t+"_"+l,(u=this.getMorePromises[r][p])?u:(this.getMorePromises[r][p]=new e.FlickrPromise({apiResponse:this.appContext.callAPI(s,n,!0),contextRegistry:this.appContext.getModelRegistry(r),personRegistry:this.appContext.getModelRegistry("person-models")}).then(function(o){var s,n,l,u=[],g=o.apiResponse,d=o.contextRegistry,f=o.personRegistry;return(n=i.split(".").reduce(function(t,r){return e.Lang.isObject(t)?t[r]:void 0},g))&&(e.Array.each(n,function(t){e.APIHelper.response.addContextToRegistry(t,d,f),u.push(d.proxy(t.id))}),u.length&&(l=c.getContextsOfType(t,r).map(function(e){return e.getValue("id")}),(u=u.filter(function(e){return-1===l.indexOf(e.getValue("id"))})).length&&c.getValue(t,"contexts").appendToListMulti(u))),void 0===(a=g.continuation)?a="-1":e.Lang.isNumber(a)&&(a+=""),s="-1"===a,c.continuationKeys[r][t]=a,delete c.getMorePromises[r][p],{type:r,newContexts:u,loadedAll:s}}),this.getMorePromises[r][p])):e.Promise.reject("[photo-contexts-models] getMoreContextsOfType was called for an ID that isn't in the registry: "+t):e.Promise.reject("[photo-contexts-models] getMoreContextsOfType was called without an invalid type: "+r)},getContextsOfType:function(t,r){return r=e.Array(r),this.getValue(t,"contexts").getList().filter(function(e){return r.indexOf(e.registry.name)>-1})},getContextsNotOfType:function(t,r){return r=e.Array(r),this.getValue(t,"contexts").getList().filter(function(e){return-1===r.indexOf(e.registry.name)})},attributes:{contexts:{isCollection:!0},totalGroups:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},totalSets:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},totalGalleries:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher","flickr-photos-getAllContexts-fetcher"]});YUI.add("album-creation-view",function(e,t){var o=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("album-creation-view",e.Views["stuff-creation-view"],[],{langBundles:this.details.langBundles,initializer:function(e){return e.heading=this.intlMessage({intlName:"add-to-stuff.CURATIONS_CREATE_A_NEW_ALBUM"}),e.placeholderTitle=this.intlMessage({intlName:"add-to-stuff.CURATIONS_ALBUM_NAME"}),e.placeholderDescription=this.intlMessage({intlName:"add-to-stuff.CURATIONS_DESCRIPTION_OPTIONAL"}),e.cancelText=this.intlMessage({intlName:"common.CANCEL"}),e.actionText=this.intlMessage({intlName:"global-nav.CREATE"}),this.photoId=e.photoId,this.dismissOnCreate=e.dismissOnCreateAlbum,this.curationType="album",this.photoIds=e.photoIds,this.titleError=this.intlMessage({intlName:"add-to-stuff.PLEASE_ENTER_ALBUM_NAME"}),this.createError=this.intlMessage({intlName:"add-to-stuff.COULDNT_SAVE_ALBUM"}),this.constructor.superclass.initializer.call(this,e)},activate:function(){var e=this.get("container");this.titleItemNode=e.one(".input-item.title-input-item"),this.titleErrorNode=e.one(".error-message.title-error"),this.createErrorNode=e.one(".error-message.create-error"),this.titleNode=e.one(".stuff-creation-title"),this.descriptionNode=e.one(".stuff-creation-description"),this.cancelButton=e.one(".button-cancel"),this.actionButton=e.one(".button-action"),this.closeButton=e.one(".close-x-button"),this.setupEvents(),this.constructor.superclass.activate.call(this,this.params)},setupEvents:function(){var e=this;this.get("container");this.registerEventHandler(this.titleNode.on("keyup",function(){e.titleNode.get("value")&&e.showTitleError(!1)})),this.registerEventHandler(this.cancelButton.on("click",function(){e.fire("cancel"),e.resetView()})),this.registerEventHandler(this.closeButton.on("click",function(){e.fire("readyToClose")})),this.registerEventHandler(this.actionButton.on("click",function(){e.createCuration()}))},createNewAndAddPhoto:function(){var t,i=this,s=!!this.photoIds,n=this.titleNode.get("value"),r=this.descriptionNode.get("value");return n?(t={photoID:s?this.photoIds[0]:this.photoId,title:n,description:r,isMultiplePhotos:s,numberOfPhotosSelected:i.params.numberOfPhotosSelected,numberOfVideosSelected:i.params.numberOfVideosSelected},this.appContext.getModelRegistry("set-models").then(function(e){return i.albumsModel=e,e.remote.create(t,i.appContext)}).then(function(e){return s&&i.photoIds.slice(1).length>0?i.addPhotos(e.getValue("id"),i.photoIds).then(function(){return e}):e}).then(function(t){if(i.titleNode.set("value",""),i.descriptionNode.set("value",""),i.fire("created",{type:i.curationType,curation:t}),e.Snowplough){var o={id:t.id,photoIds:i.photoIds},s=e.Snowplough.getAlbumContext(o);e.Snowplough.sendStructuredEvent({category:"album",action:"created"},s)}return i.params.inlineCreation?i.resetView():i.fire("readyToClose"),t}).catch(function(e){throw o.error("Error handling photo addition after album creation",{err:e}),e})):(i.showTitleError(!0,i.titleError),e.Promise.reject({message:i.titleError}))},addPhotos:function(t,o){for(var i=this,s=[],n=[],r=0;r<o.length;r+=500)s.push(o.slice(r,r+500<o.length?r+500:o.length));return s.forEach(function(e,o){n.push(i.albumsModel.remote.addPhoto({photoID:e.join(","),isMultiplePhotos:!0,photosSelectedIds:i.params.photosSelectedIds,videosSelectedIds:i.params.videosSelectedIds,numberOfPhotosSelected:i.params.numberOfPhotosSelected,numberOfVideosSelected:i.params.numberOfVideosSelected,setID:t,updateItemCounts:0===o},this.appContext))}),e.Promise.all(n).then(function(e){return e&&e[0]?e[0].setModel:null})},focusInitial:function(){this.titleNode&&this.titleNode.focus()}})},"@VERSION@",{requires:["flickr-view","stuff-creation-view"],optional:["set-models"],langBundles:["more-menu-view","common","global-nav","add-to-stuff"]});YUI.add("gallery-creation-view",function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("gallery-creation-view",e.Views["stuff-creation-view"],[],{langBundles:this.details.langBundles,initializer:function(e){return e.heading=this.intlMessage({intlName:"add-to-stuff.CURATIONS_CREATE_A_NEW_GALLERY"}),e.placeholderTitle=this.intlMessage({intlName:"add-to-stuff.CURATIONS_GALLERY_NAME"}),e.placeholderDescription=this.intlMessage({intlName:"add-to-stuff.CURATIONS_DESCRIPTION_OPTIONAL"}),e.cancelText=this.intlMessage({intlName:"common.CANCEL"}),e.actionText=this.intlMessage({intlName:"global-nav.CREATE"}),this.photoId=e.photoId,this.dismissOnCreate=e.dismissOnCreateGallery,this.curationType="gallery",this.titleError=this.intlMessage({intlName:"add-to-stuff.PLEASE_ENTER_GALLERY_NAME"}),this.createError=this.intlMessage({intlName:"add-to-stuff.COULDNT_SAVE_GALLERY"}),this.constructor.superclass.initializer.call(this,e)},activate:function(){var e=this.get("container");this.titleItemNode=e.one(".input-item.title-input-item"),this.titleErrorNode=e.one(".error-message.title-error"),this.createErrorNode=e.one(".error-message.create-error"),this.titleNode=e.one(".stuff-creation-title"),this.descriptionNode=e.one(".stuff-creation-description"),this.actionButton=e.one(".button-action"),this.setupEvents(),this.constructor.superclass.activate.call(this,this.params)},setupEvents:function(){var e=this,t=this.get("container");this.cancelButton=t.one(".button-cancel"),this.actionButton=t.one(".button-action"),this.closeButton=t.one(".close-x-button"),this.registerEventHandler(this.titleNode.on("keyup",function(){e.titleNode.get("value")&&e.showTitleError(!1)})),this.registerEventHandler(this.cancelButton.on("click",function(){e.params.inlineCreation?(e.fire("cancel"),e.resetView()):e.fire("readyToClose")})),this.registerEventHandler(this.closeButton.on("click",function(){e.fire("readyToClose")})),this.registerEventHandler(this.actionButton.on("click",function(){e.createCuration()}))},createNewAndAddPhoto:function(){var t,r=this,o=this.titleNode.get("value"),n=this.descriptionNode.get("value");return e.rapidTracker.beacon(r.name,"galleryCreationViewCreateClick"),o?(r.showError(r.createErrorNode,!1),t={photoID:r.photoId,title:o,description:n},this.appContext.getModelRegistry("gallery-models").then(function(e){return e.remote.create(t,r.appContext)}).then(function(t){if(r.photoId&&!t.getValue("primary")&&i.error("Photo cannot be added to galleries."),r.titleNode.set("value",""),r.descriptionNode.set("value",""),r.fire("created",{type:r.curationType,curation:t}),r.params.inlineCreation?r.resetView():r.fire("readyToClose"),e.Snowplough){var o={id:t.id},n=e.Snowplough.getGalleryContext(o);e.Snowplough.sendStructuredEvent({category:"gallery",action:"created"},n)}return t}).catch(function(e){throw i.error("Error handling photo addition after gallery creation",{err:e}),r.showError(r.createErrorNode,!0,r.createError),e})):(r.showTitleError(!0,r.titleError),e.Promise.reject({message:r.titleError}))},focusInitial:function(){this.titleNode&&this.titleNode.focus()}})},"@VERSION@",{requires:["flickr-view","stuff-creation-view"],langBundles:["more-menu-view","common","global-nav","add-to-stuff"]});